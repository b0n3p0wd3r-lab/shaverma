<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | Shaurmafia</title>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes">
  </head>
  <body style="text-align: left; padding: 0; border: 0; margin: 0; overflow: hidden;">
    <canvas id="unity-canvas" width=960 height=600 tabindex="-1" style="width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: #231F20"></canvas>
    
    <script>
      // ПОЛНАЯ ЭМУЛЯЦИЯ МОБИЛЬНОГО УСТРОЙСТВА
      console.log('Starting full mobile emulation...');
      
      // 1. Переопределяем User-Agent
      Object.defineProperty(navigator, 'userAgent', {
        get: function() {
          return 'Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.0 Mobile/15E148 Safari/604.1';
        },
        configurable: true
      });
      
      // 2. Переопределяем другие navigator свойства
      Object.defineProperty(navigator, 'platform', {
        get: function() { return 'iPhone'; },
        configurable: true
      });
      
      Object.defineProperty(navigator, 'maxTouchPoints', {
        get: function() { return 5; },
        configurable: true
      });
      
      // 3. Добавляем touch события
      window.ontouchstart = function() {};
      document.ontouchstart = function() {};
      
      // 4. Переопределяем размеры экрана
      Object.defineProperty(screen, 'width', {
        get: function() { return 390; },
        configurable: true
      });
      
      Object.defineProperty(screen, 'height', {
        get: function() { return 844; },
        configurable: true
      });
      
      // 5. Переопределяем размеры окна
      Object.defineProperty(window, 'innerWidth', {
        get: function() { return 390; },
        configurable: true
      });
      
      Object.defineProperty(window, 'innerHeight', {
        get: function() { return 844; },
        configurable: true
      });
      
      // 6. Переопределяем devicePixelRatio
      Object.defineProperty(window, 'devicePixelRatio', {
        get: function() { return 2; },
        configurable: true
      });
      
      // 7. Эмулируем мобильные медиа-запросы
      var originalMatchMedia = window.matchMedia;
      window.matchMedia = function(query) {
        // Для мобильных медиа-запросов возвращаем true
        if (query.includes('max-width') || query.includes('mobile') || query.includes('touch')) {
          return {
            matches: true,
            media: query,
            onchange: null,
            addListener: function() {},
            removeListener: function() {},
            addEventListener: function() {},
            removeEventListener: function() {},
            dispatchEvent: function() {}
          };
        }
        return originalMatchMedia.call(this, query);
      };
      
      // 8. Применяем мобильные стили принудительно
      var canvas = document.querySelector("#unity-canvas");
      canvas.style.width = "100%";
      canvas.style.height = "100%";
      canvas.style.position = "fixed";
      canvas.style.top = "0";
      canvas.style.left = "0";

      document.body.style.textAlign = "left";
      document.body.style.margin = "0";
      document.body.style.padding = "0";
      document.body.style.overflow = "hidden";
      
      console.log('Mobile emulation applied:');
      console.log('User-Agent:', navigator.userAgent);
      console.log('Platform:', navigator.platform);
      console.log('Touch points:', navigator.maxTouchPoints);
      console.log('Screen:', screen.width, 'x', screen.height);
      console.log('Window:', window.innerWidth, 'x', window.innerHeight);
      console.log('Device pixel ratio:', window.devicePixelRatio);
      console.log('Touch support:', 'ontouchstart' in window);
    </script>
    
    <script src="Build/SHAURMA.loader.js"></script>
    <script>
      // Теперь загружаем Unity с полной мобильной эмуляцией
      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/SHAURMA.data.br",
        frameworkUrl: "Build/SHAURMA.framework.js.br",
        codeUrl: "Build/SHAURMA.wasm.br",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Shaurmafia",
        productVersion: "0.1.0",
        matchWebGLToCanvasSize: true,
        devicePixelRatio: 2, // Мобильный DPI
      }).then((unityInstance) => {
        console.log('Unity loaded with full mobile emulation');
        
        // Отправляем сообщение Unity о мобильном режиме
        setTimeout(function() {
          try {
            unityInstance.SendMessage('GameManager', 'SetMobileMode', 'true');
            unityInstance.SendMessage('GameManager', 'SetScreenSize', '390x844');
          } catch (e) {
            console.log('Unity message sending failed (normal if GameManager not exists)');
          }
        }, 1000);
      }).catch((message) => {
        console.error('Unity loading failed:', message);
      });
    </script>
  </body>
</html>
