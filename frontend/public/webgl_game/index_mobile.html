<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes">
    <title>Unity WebGL Player | Shaurmafia</title>
  </head>
  <body style="text-align: left; padding: 0; border: 0; margin: 0; overflow: hidden;">
    <canvas id="unity-canvas" tabindex="-1" style="width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: #231F20"></canvas>
    <script src="Build/SHAURMA.loader.js"></script>
    <script>
      // Функция для динамического изменения размера canvas
      function resizeCanvas() {
        var canvas = document.querySelector("#unity-canvas");
        var container = canvas.parentElement;
        
        // Получаем размеры контейнера
        var containerWidth = container.clientWidth || window.innerWidth;
        var containerHeight = container.clientHeight || window.innerHeight;
        
        // Мобильное соотношение сторон (примерно 9:16 или близко к этому)
        var mobileAspectRatio = 9 / 16;
        var currentAspectRatio = containerWidth / containerHeight;
        
        var targetWidth, targetHeight;
        
        if (currentAspectRatio > mobileAspectRatio) {
          // Контейнер слишком широкий, подгоняем по высоте
          targetHeight = containerHeight;
          targetWidth = targetHeight * mobileAspectRatio;
        } else {
          // Контейнер слишком высокий, подгоняем по ширине
          targetWidth = containerWidth;
          targetHeight = targetWidth / mobileAspectRatio;
        }
        
        // Устанавливаем размеры canvas
        canvas.width = targetWidth;
        canvas.height = targetHeight;
        
        // Применяем CSS стили для центрирования и масштабирования
        canvas.style.width = containerWidth + "px";
        canvas.style.height = containerHeight + "px";
        canvas.style.position = "fixed";
        canvas.style.top = "0";
        canvas.style.left = "0";
        canvas.style.objectFit = "contain";
        
        console.log('Canvas resized to:', targetWidth, 'x', targetHeight, 'displayed as:', containerWidth, 'x', containerHeight);
      }

      // Принудительно применяем мобильные стили независимо от устройства
      document.body.style.textAlign = "left";
      document.body.style.margin = "0";
      document.body.style.padding = "0";
      document.body.style.overflow = "hidden";

      // Изменяем размер при загрузке
      window.addEventListener('load', resizeCanvas);
      window.addEventListener('resize', resizeCanvas);

      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/SHAURMA.data.br",
        frameworkUrl: "Build/SHAURMA.framework.js.br",
        codeUrl: "Build/SHAURMA.wasm.br",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Shaurmafia",
        productVersion: "0.1.0",
        matchWebGLToCanvasSize: true, // Включаем соответствие размеров WebGL и canvas
        devicePixelRatio: 1, // Фиксируем DPI для стабильности
      }).then((unityInstance) => {
        // После загрузки Unity принудительно изменяем размер
        setTimeout(resizeCanvas, 100);
        
        // Отправляем сообщение Unity о том, что это мобильная версия
        try {
          unityInstance.SendMessage('GameManager', 'SetMobileMode', 'true');
        } catch (e) {
          console.log('Unity message sending failed (normal if GameManager not exists)');
        }
      }).catch((message) => {
        console.error('Unity loading failed:', message);
      });
    </script>
  </body>
</html>
