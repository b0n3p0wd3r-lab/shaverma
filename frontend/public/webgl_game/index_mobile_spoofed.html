<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes">
    <title>Unity WebGL Player | Shaurmafia</title>
  </head>
  <body style="text-align: left; padding: 0; border: 0; margin: 0; overflow: hidden;">
    <canvas id="unity-canvas" tabindex="-1" style="width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: #231F20"></canvas>
    <script>
      // КРИТИЧЕСКИ ВАЖНО: Подменяем User-Agent и другие свойства ДО загрузки Unity
      
      // Сохраняем оригинальные значения
      var originalUserAgent = navigator.userAgent;
      var originalPlatform = navigator.platform;
      var originalMaxTouchPoints = navigator.maxTouchPoints;
      
      // Подменяем navigator.userAgent на мобильный
      Object.defineProperty(navigator, 'userAgent', {
        get: function() {
          return 'Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.0 Mobile/15E148 Safari/604.1';
        },
        configurable: true
      });
      
      // Подменяем platform
      Object.defineProperty(navigator, 'platform', {
        get: function() {
          return 'iPhone';
        },
        configurable: true
      });
      
      // Подменяем maxTouchPoints
      Object.defineProperty(navigator, 'maxTouchPoints', {
        get: function() {
          return 5;
        },
        configurable: true
      });
      
      // Добавляем поддержку touch событий
      if (!('ontouchstart' in window)) {
        window.ontouchstart = null;
        document.ontouchstart = null;
      }
      
      // Подменяем screen размеры
      Object.defineProperty(screen, 'width', {
        get: function() { return 390; },
        configurable: true
      });
      
      Object.defineProperty(screen, 'height', {
        get: function() { return 844; },
        configurable: true
      });
      
      Object.defineProperty(screen, 'availWidth', {
        get: function() { return 390; },
        configurable: true
      });
      
      Object.defineProperty(screen, 'availHeight', {
        get: function() { return 844; },
        configurable: true
      });
      
      // Подменяем window размеры
      Object.defineProperty(window, 'innerWidth', {
        get: function() { return 390; },
        configurable: true
      });
      
      Object.defineProperty(window, 'innerHeight', {
        get: function() { return 844; },
        configurable: true
      });
      
      Object.defineProperty(window, 'outerWidth', {
        get: function() { return 390; },
        configurable: true
      });
      
      Object.defineProperty(window, 'outerHeight', {
        get: function() { return 844; },
        configurable: true
      });
      
      console.log('Mobile spoofing applied:');
      console.log('User-Agent:', navigator.userAgent);
      console.log('Platform:', navigator.platform);
      console.log('Screen size:', screen.width, 'x', screen.height);
      console.log('Window size:', window.innerWidth, 'x', window.innerHeight);
      console.log('Touch support:', 'ontouchstart' in window);
      
      // Применяем мобильные стили
      var canvas = document.querySelector("#unity-canvas");
      canvas.style.width = "100%";
      canvas.style.height = "100%";
      canvas.style.position = "fixed";
      canvas.style.top = "0";
      canvas.style.left = "0";

      document.body.style.textAlign = "left";
      document.body.style.margin = "0";
      document.body.style.padding = "0";
      document.body.style.overflow = "hidden";
    </script>
    
    <script src="Build/SHAURMA.loader.js"></script>
    <script>
      // Теперь загружаем Unity - он должен думать что это мобильное устройство
      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/SHAURMA.data.br",
        frameworkUrl: "Build/SHAURMA.framework.js.br",
        codeUrl: "Build/SHAURMA.wasm.br",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Shaurmafia",
        productVersion: "0.1.0",
        matchWebGLToCanvasSize: true,
        devicePixelRatio: 1,
      }).then((unityInstance) => {
        console.log('Unity loaded with mobile spoofing');
        
        // Отправляем сообщение Unity о мобильном режиме
        try {
          unityInstance.SendMessage('GameManager', 'SetMobileMode', 'true');
        } catch (e) {
          console.log('Unity message sending failed (normal if GameManager not exists)');
        }
      }).catch((message) => {
        console.error('Unity loading failed:', message);
      });
    </script>
  </body>
</html>
